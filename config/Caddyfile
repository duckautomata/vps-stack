# Define a snippet for security headers
(secure) {
    header {
        Strict-Transport-Security "max-age=43200; includeSubDomains; preload"
        X-Frame-Options "DENY"
    }
}

(secure_admin) {
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Frame-Options "DENY"
    }
    basicauth {
        admin $2a$14$your_long_hash_string_here...
    }
}

portainer.duck-automata.com {
    import secure_admin
    tls /certs/cloudflare.crt /certs/cloudflare.key
    reverse_proxy portainer:9000
}

cockpit.duck-automata.com {
    import secure_admin
    tls /certs/cloudflare.crt /certs/cloudflare.key
    
    reverse_proxy 172.17.0.1:9090 {
        header_up Host {host}
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
    }
}

api.duck-automata.com {
    import secure
    tls /certs/cloudflare.crt /certs/cloudflare.key
    reverse_proxy api:8080
}

archive.duck-automata.com {
    import secure
    tls /certs/cloudflare.crt /certs/cloudflare.key
    reverse_proxy archive:8080
}

grafana.duck-automata.com {
    import secure
    tls /certs/cloudflare.crt /certs/cloudflare.key
    reverse_proxy grafana:3000
}
